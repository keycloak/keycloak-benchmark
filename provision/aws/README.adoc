= AWS provisioning module

This module is intended to automate tasks around provisioning OpenShift clusters in AWS via ROSA tool,
as described in the ROSA installation guide: https://console.redhat.com/openshift/create/rosa/getstarted

== Prerequisities

. Enable ROSA Service in AWS account - *MANUAL STEP*
. Download and install the ROSA and AWS command line tools - *MANUAL STEP*
. Create the service linked role for the Elastic Load Balancer
. Log in to the ROSA CLI with your Red Hat account token and create AWS account roles and policies - *MANUAL STEP*
. Verify your credentials and quota

== Installation

The installation process is automated in the `rosa_create_cluster.sh` script
which takes its parameters from environment variables.

It will load environment variables pre-set in `.env` file inside the `aws/` directory.

The script will create the OCP cluster via `rosa create cluster` command, 
additionally it will create the required operator roles and OIDC provider.
After the installation process is finished it will create a new admin user.

=== Optional parameters:
- `CLUSTER_NAME` - Name of the cluster. If not set, the value of `$(whoami)` command will be used.
- `ADMIN_PASSWORD` - Password for the `cluster-admin` user. If not set, it will be autogenerated by `rosa create admin`.

=== Mandatory parameters:
- `VERSION` - OCP cluster version.
- `REGION` - AWS region where the cluster should run.
- `COMPUTE_MACHINE_TYPE` - https://aws.amazon.com/ec2/instance-types/[AWS instance type] for the default OCP worker machine pool.
- `MULTI_AZ` - Boolean parameter to indicate whether the OCP cluster should span multiple Availability Zones within the selected region.
- `REPLICAS` - Number of worker nodes. If multi-AZ installation is selected then this needs to be a multiple 
of the number of AZs available in the region. For example if the region has 3 AZs, then replicas need to be set to some multiple of 3.

=== Example `.env` file
[source,bash]
----
CLUSTER_NAME=rosa-kcb
ADMIN_PASSWORD=needs-to-have-at-least-14-ascii-characters
VERSION=4.12.15
REGION=eu-central-1
COMPUTE_MACHINE_TYPE=m5.xlarge
MULTI_AZ=false
REPLICAS=3
----


== Re-create admin user

The above installation script will create an admin user automatically but in case
the user needs to re-created it can be done via the `rosa_recreate_admin.sh` script, 
providing the `CLUSTER_NAME` and optionally `ADMIN_PASSWORD` parameter.

Additionally, an AWS secret named `${CLUSTER_NAME}-cluster-admin` will be created via AWS Secrets Manager.


== Uninstallation

The uninstallation is handled by the `rosa_delete_cluster.sh` script.

The only required parameter is `CLUSTER_NAME`.

Additionally it will delete cluster's operator roles and OIDC provider, 
and the admin user.
